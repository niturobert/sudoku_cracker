<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>
	<center>
		<h2>Sudoku Cracker</h2>
		<table>
			<tr>
				<td>
					<input type="number" min="1" max="9" step="1" id="r1c1">
					<input type="number" min="1" max="9" step="1" id="r1c2">
					<input type="number" min="1" max="9" step="1" id="r1c3">
					<input type="number" min="1" max="9" step="1" id="r1c4">
					<input type="number" min="1" max="9" step="1" id="r1c5">
					<input type="number" min="1" max="9" step="1" id="r1c6">
					<input type="number" min="1" max="9" step="1" id="r1c7">
					<input type="number" min="1" max="9" step="1" id="r1c8">
					<input type="number" min="1" max="9" step="1" id="r1c9">
				</td>
			</tr>
			<tr>
				<td>
					<input type="number" min="1" max="9" step="1" id="r2c1">
					<input type="number" min="1" max="9" step="1" id="r2c2">
					<input type="number" min="1" max="9" step="1" id="r2c3">
					<input type="number" min="1" max="9" step="1" id="r2c4">
					<input type="number" min="1" max="9" step="1" id="r2c5">
					<input type="number" min="1" max="9" step="1" id="r2c6">
					<input type="number" min="1" max="9" step="1" id="r2c7">
					<input type="number" min="1" max="9" step="1" id="r2c8">
					<input type="number" min="1" max="9" step="1" id="r2c9">
				</td>
			</tr>
			<tr>
				<td>
					<input type="number" min="1" max="9" step="1" id="r3c1">
					<input type="number" min="1" max="9" step="1" id="r3c2">
					<input type="number" min="1" max="9" step="1" id="r3c3">
					<input type="number" min="1" max="9" step="1" id="r3c4">
					<input type="number" min="1" max="9" step="1" id="r3c5">
					<input type="number" min="1" max="9" step="1" id="r3c6">
					<input type="number" min="1" max="9" step="1" id="r3c7">
					<input type="number" min="1" max="9" step="1" id="r3c8">
					<input type="number" min="1" max="9" step="1" id="r3c9">
				</td>
			</tr>
			<tr>
				<td>
					<input type="number" min="1" max="9" step="1" id="r4c1">
					<input type="number" min="1" max="9" step="1" id="r4c2">
					<input type="number" min="1" max="9" step="1" id="r4c3">
					<input type="number" min="1" max="9" step="1" id="r4c4">
					<input type="number" min="1" max="9" step="1" id="r4c5">
					<input type="number" min="1" max="9" step="1" id="r4c6">
					<input type="number" min="1" max="9" step="1" id="r4c7">
					<input type="number" min="1" max="9" step="1" id="r4c8">
					<input type="number" min="1" max="9" step="1" id="r4c9">
				</td>
			</tr>
			<tr>
				<td>
					<input type="number" min="1" max="9" step="1" id="r5c1">
					<input type="number" min="1" max="9" step="1" id="r5c2">
					<input type="number" min="1" max="9" step="1" id="r5c3">
					<input type="number" min="1" max="9" step="1" id="r5c4">
					<input type="number" min="1" max="9" step="1" id="r5c5">
					<input type="number" min="1" max="9" step="1" id="r5c6">
					<input type="number" min="1" max="9" step="1" id="r5c7">
					<input type="number" min="1" max="9" step="1" id="r5c8">
					<input type="number" min="1" max="9" step="1" id="r5c9">
				</td>
			</tr>
			<tr>
				<td>
					<input type="number" min="1" max="9" step="1" id="r6c1">
					<input type="number" min="1" max="9" step="1" id="r6c2">
					<input type="number" min="1" max="9" step="1" id="r6c3">
					<input type="number" min="1" max="9" step="1" id="r6c4">
					<input type="number" min="1" max="9" step="1" id="r6c5">
					<input type="number" min="1" max="9" step="1" id="r6c6">
					<input type="number" min="1" max="9" step="1" id="r6c7">
					<input type="number" min="1" max="9" step="1" id="r6c8">
					<input type="number" min="1" max="9" step="1" id="r6c9">
				</td>
			</tr>
			<tr>
				<td>
					<input type="number" min="1" max="9" step="1" id="r7c1">
					<input type="number" min="1" max="9" step="1" id="r7c2">
					<input type="number" min="1" max="9" step="1" id="r7c3">
					<input type="number" min="1" max="9" step="1" id="r7c4">
					<input type="number" min="1" max="9" step="1" id="r7c5">
					<input type="number" min="1" max="9" step="1" id="r7c6">
					<input type="number" min="1" max="9" step="1" id="r7c7">
					<input type="number" min="1" max="9" step="1" id="r7c8">
					<input type="number" min="1" max="9" step="1" id="r7c9">
				</td>
			</tr>
			<tr>
				<td>
					<input type="number" min="1" max="9" step="1" id="r8c1">
					<input type="number" min="1" max="9" step="1" id="r8c2">
					<input type="number" min="1" max="9" step="1" id="r8c3">
					<input type="number" min="1" max="9" step="1" id="r8c4">
					<input type="number" min="1" max="9" step="1" id="r8c5">
					<input type="number" min="1" max="9" step="1" id="r8c6">
					<input type="number" min="1" max="9" step="1" id="r8c7">
					<input type="number" min="1" max="9" step="1" id="r8c8">
					<input type="number" min="1" max="9" step="1" id="r8c9">
				</td>
			</tr>
			<tr>
				<td>
					<input type="number" min="1" max="9" step="1" id="r9c1">
					<input type="number" min="1" max="9" step="1" id="r9c2">
					<input type="number" min="1" max="9" step="1" id="r9c3">
					<input type="number" min="1" max="9" step="1" id="r9c4">
					<input type="number" min="1" max="9" step="1" id="r9c5">
					<input type="number" min="1" max="9" step="1" id="r9c6">
					<input type="number" min="1" max="9" step="1" id="r9c7">
					<input type="number" min="1" max="9" step="1" id="r9c8">
					<input type="number" min="1" max="9" step="1" id="r9c9">
				</td>
			</tr>
		</table>
		<br /><br />
		<button class="uk-button uk-button-primary" id="hack_sudoku" onclick="hack_sudoku()">Hack sudoku</button>
		<button class="uk-button uk-button-primary" id="clear_board" onclick="clear_board()" hidden>Clear Board</button>
		<button class="uk-button uk-button-secondary" onclick="load_example()">Load Example</button>
	</center>
</body>

<script>
	class GameEngine {
		constructor() {

		}

		getValue(position) {
			let element = document.getElementById(`r${position[0]}c${position[1]}`)

			return element.value
		}

		setValue(position, value) {
			let element = document.getElementById(`r${position[0]}c${position[1]}`)
			element.classList.add("solution")

			element.value = value
		}

		isFinished() {
			let indexes = [1, 2, 3, 4, 5, 6, 7, 8, 9]
			let finished = true

			indexes.forEach(row => {
				indexes.forEach(col => {
					if (this.getValue([row, col]) == "") finished = false
				})
			})

			return finished
		}

		getFieldCellsFromPosition(position) {
			let padding_row = 3 * Math.floor((position[0] - 1 ) / 3) + 1
			let padding_col = 3 * Math.floor((position[1] - 1 ) / 3) + 1

		// console.log(`row -> ${padding_row}\ncol -> ${padding_col}`)

		let output = [[padding_row + 0, padding_col + 0], [padding_row + 0, padding_col + 1], [padding_row + 0, padding_col + 2], [padding_row + 1, padding_col + 0], [padding_row + 1, padding_col + 1], [padding_row + 1, padding_col + 2], [padding_row + 2, padding_col + 0], [padding_row + 2, padding_col + 2], [padding_row + 2, padding_col + 2]]
		// console.log(output)
		return output
	}

	getValidAnswers(position) {
		let valid_answers = []
		let all_answers = [1, 2, 3, 4, 5, 6, 7, 8, 9]

		all_answers.forEach(answer => {
			let is_valid = true

			// Verifica orizzontale.
			let row_cells = all_answers
			row_cells.forEach(row => {
				if (this.getValue([row, position[1]]) == answer) {
					is_valid = false
				}
			})

			// Verifica verticale.
			let col_cells = all_answers
			col_cells.forEach(col => {
				if (this.getValue([position[0], col]) == answer) {
					is_valid = false
				}
			})

			// Verifica celle della sezione.
			let field_cells = this.getFieldCellsFromPosition(position)
			field_cells.forEach(cell => {
				if (this.getValue(cell) == answer) {
					is_valid = false
				}
			})


			if (is_valid) {
				valid_answers.push(answer)
			}
		})

		return valid_answers
	}
}

var game_engine = new GameEngine()

var load_example = function() {
	let indexes = [1, 2, 3, 4, 5, 6, 7, 8, 9]
	indexes.forEach(row => {
		indexes.forEach(col => {
			let element = document.getElementById("r" + row + "c" + col)
			element.classList.remove("solution")
			element.value = ""
		})
	})

	puzzle = [
		[[1, 1], 5],
		[[1, 2], 3],
		[[1, 5], 7],
		[[2, 1], 6],
		[[2, 4], 1],
		[[2, 5], 9],
		[[2, 6], 5],
		[[3, 2], 9],
		[[3, 3], 8],
		[[3, 8], 6],
		[[4, 1], 8],
		[[4, 5], 6],
		[[4, 9], 3],
		[[5, 1], 4],
		[[5, 4], 8],
		[[5, 6], 3],
		[[5, 9], 1],
		[[6, 1], 7],
		[[6, 5], 2],
		[[6, 9], 6],
		[[7, 2], 6],
		[[7, 7], 2],
		[[7, 8], 8],
		[[8, 4], 4],
		[[8, 5], 1],
		[[8, 6], 9],
		[[8, 9], 5],
		[[9, 5], 8],
		[[9, 8], 7],
		[[9, 9], 9]
	]

	puzzle.forEach(el => {
		document.getElementById(`r${el[0][0]}c${el[0][1]}`).value = el[1]
	})
}

var hack_sudoku = function() {
	let solution_cycle = function(){
		let indexes = [1, 2, 3, 4, 5, 6, 7, 8, 9]

		indexes.forEach(row => {
			indexes.forEach(col => {
				if (game_engine.getValue([row, col]) == "") {
					let solutions = game_engine.getValidAnswers([row, col])
					if (solutions.length == 1) {
						game_engine.setValue([row, col], solutions[0])
					}
				}
			})
		})
	}

	document.getElementById("clear_board").hidden = false
	document.getElementById("hack_sudoku").hidden = true

	for (let i = 0; i < 60; i++) {
		solution_cycle()

		if (game_engine.isFinished()) {
			alert("Hacked!")
			return;
		}
	}

	alert("No definitive solution found! I am not smart enough")
}

var clear_board = function() {
	document.getElementById("hack_sudoku").hidden = false
	document.getElementById("clear_board").hidden = true

	let indexes = [1, 2, 3, 4, 5, 6, 7, 8, 9]
	indexes.forEach(row => {
		indexes.forEach(col => {
			let element = document.getElementById("r" + row + "c" + col)
			element.classList.remove("solution")
			element.value = ""
		})
	})
}

</script>

<style>
	input {
		font-size: 2em;
		text-align: center;
		width: 7vw;
		height: 7vw;

		max-width: 50px;
		max-height: 50px;
	}

	.solution {
		color: #32fa32;
	}

	input::-webkit-outer-spin-button,
	input::-webkit-inner-spin-button {
		-webkit-appearance: none;
		margin: 0;
	}

	input[type=number] {
		-moz-appearance: textfield;
	}

</style>
<!-- UIkit CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.5.8/dist/css/uikit.min.css" />

<!-- UIkit JS -->
<script src="https://cdn.jsdelivr.net/npm/uikit@3.5.8/dist/js/uikit.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/uikit@3.5.8/dist/js/uikit-icons.min.js"></script>


</html>